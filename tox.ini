[tox]
envlist =
  py{39,310,311,312,313,314}-lint,
  py{39,310,311,312,313,314}-unit,
  py{39,310,311,312,313,314}-bandit,
  py{39,310,311,312,313,314}-mypy,
  py312-pydocstyle
isolated_build = True
skip_missing_interpreters = True

[gh-actions]
python =
  3.9: py39
  3.10: py310
  3.11: py311
  3.12: py312
  3.13: py313
  3.14: py314

[testenv]
description =
  py{39,310,311,312,313,314}-unit: Run the unit tests
  py{39,310,311,312,313,314}-lint: Lint the Python code
  py{39,310,311,312,313,314}-bandit: Search for common security issues
  py{39,310,311,312,313,314}-mypy: Check for type safety
  py310-pydocstyle: docstring style checker

passenv =
  CI
  GITHUB_*
deps =
  py{39,310,311,312,313,314}-{unit,mypy}: -rrequirements.txt
  py{39,310,311,312,313,314}-{unit,mypy}: -rtest-requirements.txt
  py{39,310,311,312,313,314}-lint: flake8-bugbear
  py{39,310,311,312,313,314}-lint: black
  py{39,310,311,312,313,314}-bandit: bandit
  py{39,310,311,312,313,314}-mypy: -rmypy-requirements.txt

setenv =
  py{39,310,311,312,313,314}-unit: LC_ALL = C.UTF-8

commands =
  py{39,310,311,312,313,314}-unit: make test
  py{39,310,311,312,313,314}-bandit: bandit --recursive cwlprov
  py{39,310,311,312,313,314}-lint: make flake8
  py{39,310,311,312,313,314}-lint: make format-check
  py{39,310,311,312,313,314}-mypy: make mypy

allowlist_externals =
  py{39,310,311,312,313,314}-lint: flake8
  py{39,310,311,312,313,314}-lint: black
  py{39,310,311,312,313,314}-{mypy,shellcheck,lint,unit}: make

skip_install =
  py{39,310,311,312,313,314}-lint: true
  py{39,310,311,312,313,314}-bandit: true

[testenv:py312-pydocstyle]
whitelist_externals = make
commands = make diff_pydocstyle_report
deps =
    pydocstyle
    diff-cover
skip_install = true

